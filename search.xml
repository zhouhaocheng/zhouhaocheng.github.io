<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title><![CDATA[文本处理工具-awk]]></title>
      <url>/2017/12/24/%E6%96%87%E6%9C%AC%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7-awk/</url>
      <content type="html"><![CDATA[<blockquote>
<p> 1.AWK是一种处理文本文件的语言，是一个强大的文本分析工具。之所以叫AWK是因为其取了三位创始人 Alfred Aho，Peter Weinberger, 和 Brian Kernighan 的Family Name的首字符。<br>2.不同于sed以行为单位，awk是基于列的文本处理工具，它的工作方式是按行读取文本并视为一条记录，每条记录以字段分割成若干字段，然后输出各字段的值。<br>3.awk认为文件都是结构化的，也就是说都是由单词和各种空白字符组成的，这里的“空白字符” 包括、Tab，以及连续的空格和Tab等。每个非空白的部分叫做“域”，从左到右一次是第一个域，第二个域，等等。</p>
</blockquote>
<h3 id="1、-2分别用于表示域，-0则表示全部域。"><a href="#1、-2分别用于表示域，-0则表示全部域。" class="headerlink" title="$1、$2分别用于表示域，$0则表示全部域。"></a>$1、$2分别用于表示域，$0则表示全部域。</h3><h1 id="awk语法："><a href="#awk语法：" class="headerlink" title="awk语法："></a>awk语法：</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">awk [选项参数] &apos;script&apos; var=value file(s)</span><br><span class="line">或者</span><br><span class="line">awk [选项参数] -f scriptfile var=value file(s)</span><br><span class="line">`</span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>参数</th>
<th style="text-align:center">作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>-F fs or –field-separator fs</td>
<td style="text-align:center">指定输入文件折分隔符，fs是一个字符串或者是一个正则表达式，如-F:</td>
</tr>
<tr>
<td>-v var=value or –asign var=value</td>
<td style="text-align:center">赋值一个用户定义变量</td>
</tr>
<tr>
<td>-f scripfile or –file scriptfile</td>
<td style="text-align:center">从脚本文件中读取awk命令</td>
</tr>
<tr>
<td>-mf nnn and -mr nnn</td>
<td style="text-align:center">对nnn值设置内在限制，-mf选项限制分配给nnn的最大块数目；-mr选项限制记录的最大数目。这两个功能是Bell实验室版awk的扩展功能，在标准awk中不适用</td>
</tr>
<tr>
<td>-W compact or –compat, -W traditional or –traditional</td>
<td style="text-align:center">在兼容模式下运行awk。所以gawk的行为和标准的awk完全一样，所有的awk扩展都被忽略</td>
</tr>
<tr>
<td>-W copyleft or –copyleft, -W copyright or –copyright</td>
<td style="text-align:center">打印简短的版权信息</td>
</tr>
<tr>
<td>-W help or –help, -W usage or –usage</td>
<td style="text-align:center">打印全部awk选项和每个选项的简短说明</td>
</tr>
<tr>
<td>-W lint or –lint</td>
<td style="text-align:center">打印不能向传统unix平台移植的结构的警告</td>
</tr>
<tr>
<td>-W lint-old or –lint-old</td>
<td style="text-align:center">打印关于不能向传统unix平台移植的结构的警告</td>
</tr>
<tr>
<td>-W posix</td>
<td style="text-align:center">打开兼容模式。但有以下限制，不识别：/x、函数关键字、func、换码序列以及当fs是一个空格时，将新行作为一个域分隔符；操作符<strong>和</strong>=不能代替^和^=；fflush无效</td>
</tr>
<tr>
<td>-W re-interval or –re-inerval</td>
<td style="text-align:center">允许间隔正则表达式的使用，参考(grep中的Posix字符类)，如括号表达式[[:alpha:]]</td>
</tr>
<tr>
<td>-W source program-text or –source program-text</td>
<td style="text-align:center">使用program-text作为源代码，可与-f命令混用</td>
</tr>
<tr>
<td>-W version or –version</td>
<td style="text-align:center">打印bug报告信息的版本</td>
</tr>
</tbody>
</table>
<h1 id="awk常用的方法："><a href="#awk常用的方法：" class="headerlink" title="awk常用的方法："></a>awk常用的方法：</h1><h4 id="创建一个awk-txt文件，以此文件为例"><a href="#创建一个awk-txt文件，以此文件为例" class="headerlink" title="创建一个awk.txt文件，以此文件为例"></a>创建一个awk.txt文件，以此文件为例</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@haocheng ~]# cat awk.txt </span><br><span class="line">john.wang  Male   30 021-11111111</span><br><span class="line">lucy.yang  Female 25 021-22222222</span><br><span class="line">jack.chen  Male   35 021-33333333</span><br><span class="line">lily.gong  Female 20 021-44444444  ShangHai</span><br></pre></td></tr></table></figure>
<h4 id="1、打印指定域"><a href="#1、打印指定域" class="headerlink" title="1、打印指定域"></a>1、打印指定域</h4><blockquote>
<p>既然awk使用$1、$2代表不同的域，则可以打印指定的域。拿awk.txt的第一行来说，第一个域为join.wang，第二个域为Male，第三个域为30、第四个域为021-11111111<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">打印$1、$4这两个域：</span><br><span class="line">[root@haocheng ~]# awk &apos;&#123;print $1,$4&#125;&apos; awk.txt </span><br><span class="line">john.wang 021-11111111</span><br><span class="line">lucy.yang 021-22222222</span><br><span class="line">jack.chen 021-33333333</span><br><span class="line">lily.gong 021-44444444</span><br></pre></td></tr></table></figure></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">打印全部内容：</span><br><span class="line">[root@haocheng ~]# awk &apos;&#123;print $0&#125;&apos; awk.txt     </span><br><span class="line">john.wang  Male   30 021-11111111</span><br><span class="line">lucy.yang  Female 25 021-22222222</span><br><span class="line">jack.chen  Male   35 021-33333333</span><br><span class="line">lily.gong  Female 20 021-44444444  ShangHai</span><br></pre></td></tr></table></figure>
<h4 id="2、指定打印分隔符"><a href="#2、指定打印分隔符" class="headerlink" title="2、指定打印分隔符"></a>2、指定打印分隔符</h4><blockquote>
<p>默认情况下awk是使用空白字符作为分隔符的，但是也可以通过-F参数指定分隔符，来区分不同的域（有点像cut命令）。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">指定 “.” 作为分隔符，这样每一行的$1就是 &quot;.&quot; 之前的字符，$2就是 &quot;.&quot;之后的字符</span><br><span class="line">比如第一行的$1是“join”，$2是“Male    30    021-11111111”</span><br><span class="line">[root@haocheng ~]# awk -F. &apos;&#123;print $1&#125;&apos; awk.txt </span><br><span class="line">john</span><br><span class="line">lucy</span><br><span class="line">jack</span><br><span class="line">lily</span><br><span class="line">[root@haocheng ~]# awk -F. &apos;&#123;print $2&#125;&apos; awk.txt  </span><br><span class="line">wang  Male        30 021-11111111</span><br><span class="line">yang  Female 25 021-22222222</span><br><span class="line">chen  Male   35 021-33333333</span><br><span class="line">gong  Female 20 021-44444444  ShangHai</span><br><span class="line">[root@haocheng ~]# awk -F. &apos;&#123;print $1,$2&#125;&apos; awk.txt  </span><br><span class="line">john wang  Male   30 021-11111111</span><br><span class="line">lucy yang  Female 25 021-22222222</span><br><span class="line">jack chen  Male   35 021-33333333</span><br><span class="line">lily gong  Female 20 021-44444444  ShangHai</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h4 id="3、内部变量NF"><a href="#3、内部变量NF" class="headerlink" title="3、内部变量NF"></a>3、内部变量NF</h4><blockquote>
<p>文件awk.txt所包含的内容不多，所以很容易的知道它的前3行中每行都有4个域，最后一行是5个域。但是如果有时候文件很大，每行列数都不一样，考观察就不现实了，必须通过特定的方式来获得文件的列数。通过awk的内部变量NF可以简单地做到这点。当然，如果指定了不同的分隔符，结果可能不一样<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">使用默认分隔符：</span><br><span class="line">[root@haocheng ~]# awk &apos;&#123;print NF&#125;&apos; awk.txt </span><br><span class="line">4</span><br><span class="line">4</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">[root@haocheng ~]# awk -F. &apos;&#123;print NF&#125;&apos; awk.txt  </span><br><span class="line">2</span><br><span class="line">2</span><br><span class="line">2</span><br><span class="line">2</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h4 id="4、打印固定域"><a href="#4、打印固定域" class="headerlink" title="4、打印固定域"></a>4、打印固定域</h4><blockquote>
<p>  通过内部变量可以简单地得到每行的列数，而如果在NF之前加上$符号，则代表“最后一列”，这样不管每行有多少列，只要使用$NF就能打印出最后一列<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">打印最后一列:</span><br><span class="line">[root@haocheng ~]# awk &apos;&#123;print $NF&#125;&apos; awk.txt     </span><br><span class="line">021-11111111</span><br><span class="line">021-22222222</span><br><span class="line">021-33333333</span><br><span class="line">ShangHai</span><br><span class="line">打印倒数第二列:</span><br><span class="line">[root@haocheng ~]# awk &apos;&#123;print $(NF-1)&#125;&apos; awk.txt </span><br><span class="line">30</span><br><span class="line">25</span><br><span class="line">35</span><br><span class="line">021-44444444</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h4 id="5、截取字符串"><a href="#5、截取字符串" class="headerlink" title="5、截取字符串"></a>5、截取字符串</h4><blockquote>
<p>可以使用substr()函数对指定域截取字符串。substr（指定域，第一个开始字符的位置，第二个结束的位置）其中第二个结束的位置可以为空，这样默认输出到该域的最后一个字符</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">输出awk.txt文件第一个域的第六个字符到最后一个字符的内容：</span><br><span class="line">[root@haocheng ~]# cat awk.txt |awk &apos;&#123;print substr($1,6)&#125;&apos;</span><br><span class="line">wang</span><br><span class="line">yang</span><br><span class="line">chen</span><br><span class="line">gong</span><br></pre></td></tr></table></figure>
<h4 id="6、确定字符串的长度"><a href="#6、确定字符串的长度" class="headerlink" title="6、确定字符串的长度"></a>6、确定字符串的长度</h4><blockquote>
<p>使用内部函数length可以确定字符串的长度。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@haocheng ~]# cat awk.txt |awk &apos;&#123;print $0&#125;&apos;</span><br><span class="line">john.wang  Male   30 021-11111111</span><br><span class="line">lucy.yang  Female 25 021-22222222</span><br><span class="line">jack.chen  Male   35 021-33333333</span><br><span class="line">lily.gong  Female 20 021-44444444  ShangHai</span><br><span class="line">[root@haocheng ~]# cat awk.txt |awk &apos;&#123;print length&#125;&apos;        </span><br><span class="line">33</span><br><span class="line">33</span><br><span class="line">33</span><br><span class="line">43</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h4 id="7、使用awk求列和"><a href="#7、使用awk求列和" class="headerlink" title="7、使用awk求列和"></a>7、使用awk求列和</h4><blockquote>
<p>结构化的数据在系统中是随处可见的，比如用ls -l命令得到的输出、各类系统的日志等。在日常工作中，经常有将其中的数据进行相加的需求。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">假设awk.txt的第三个域是年龄字段，对所有人的年龄进行计算：</span><br><span class="line">[root@haocheng ~]# cat awk.txt |awk &apos;BEGIN&#123;total=0&#125;&#123;total+=$3&#125;END&#123;print total&#125;&apos;</span><br><span class="line">110</span><br><span class="line">[root@haocheng ~]# cat awk.txt |awk &apos;BEGIN&#123;total=0&#125;&#123;total+=$3&#125;END&#123;print total/NR&#125;&apos;</span><br><span class="line">27.5</span><br></pre></td></tr></table></figure></p>
</blockquote>
]]></content>
      
        
        <tags>
            
            <tag> Linux </tag>
            
            <tag> awk </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Python爬虫之爬取美女图片]]></title>
      <url>/2017/12/24/Python%E7%88%AC%E8%99%AB%E4%B9%8B%E7%88%AC%E5%8F%96%E7%BE%8E%E5%A5%B3%E5%9B%BE%E7%89%87/</url>
      <content type="html"><![CDATA[<blockquote>
<p>需求：最近对python爬虫感兴趣，于是学习了下python爬虫并找了个网站练习，练习网址：<a href="http://www.mmjpg.com,其中每一套图都是一张一个页面，存一套图如果是手动得点翻几十个页面，但如果使用爬虫的话，就很方便了，轻轻松松就可以把美女存到硬盘了。" target="_blank" rel="noopener">http://www.mmjpg.com,其中每一套图都是一张一个页面，存一套图如果是手动得点翻几十个页面，但如果使用爬虫的话，就很方便了，轻轻松松就可以把美女存到硬盘了。</a></p>
</blockquote>
<h1 id="实验环境："><a href="#实验环境：" class="headerlink" title="实验环境："></a>实验环境：</h1><ul>
<li>Windows 10，Python 2.7.6，Pycharm<h1 id="1-确定目标网址"><a href="#1-确定目标网址" class="headerlink" title="1.确定目标网址"></a>1.确定目标网址</h1><a id="more"></a>
<img src="http://upload-images.jianshu.io/upload_images/8672685-d92a0af4dc3dc466.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/666" alt="www.mmjpg.com"><h1 id="2-分析网页URL变化"><a href="#2-分析网页URL变化" class="headerlink" title="2.分析网页URL变化"></a>2.分析网页URL变化</h1><blockquote>
<p>通过打开不同页数的页面内容后发现<br>第二页：<a href="http://www.mmjpg.com/home/2" target="_blank" rel="noopener">http://www.mmjpg.com/home/2</a><br>第三页：<a href="http://www.mmjpg.com/home/3" target="_blank" rel="noopener">http://www.mmjpg.com/home/3</a><br>每当我们点击一个页面，url改变的是最后面的数字，因此我们需要找到总页数的html代码，才能对其进行爬虫翻页</p>
<h1 id="3-分析网页源代码"><a href="#3-分析网页源代码" class="headerlink" title="3.分析网页源代码"></a>3.分析网页源代码</h1><p>通过审查网页元素定位到了总页数的html元素：<a href="/home/79" class="last">最旧</a> 由此可以得出该网址的总页数为79页，接下来便可对其进行提取</p>
<h1 id="4-引入所需要的库"><a href="#4-引入所需要的库" class="headerlink" title="4.引入所需要的库"></a>4.引入所需要的库</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">import re</span><br><span class="line">import urllib2                                                                                                          </span><br><span class="line">from lxml import html</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
</ul>
<h1 id="5-获取网页源代码"><a href="#5-获取网页源代码" class="headerlink" title="5.获取网页源代码"></a>5.获取网页源代码</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">def get_source_page(self, url):</span><br><span class="line">    &apos;&apos;&apos;</span><br><span class="line">    返回经过lxml.html.fromstring 模块处理的&lt;Element html at 0x36e8278&gt;</span><br><span class="line">    可以用 XPath 来过滤数据</span><br><span class="line">    &apos;&apos;&apos;</span><br><span class="line">    try:</span><br><span class="line">        response = urllib2.urlopen(url, timeout=3).read()</span><br><span class="line">        selector = html.fromstring(response)</span><br><span class="line">    except:</span><br><span class="line">        selector = None</span><br><span class="line">    finally:</span><br><span class="line">        return selector</span><br></pre></td></tr></table></figure>
<h1 id="6-获取总页数"><a href="#6-获取总页数" class="headerlink" title="6.获取总页数"></a>6.获取总页数</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def get_sum_page(self, url):</span><br><span class="line">    selector = self.get_source_page(url)</span><br><span class="line">    &apos;&apos;&apos;使用xpath提取网页中总页数的元素&apos;&apos;&apos;</span><br><span class="line">    sum_page = selector.xpath(&apos;//div[@class=&quot;page&quot;]//a[last()]/@href&apos;)[0].split(&apos;/&apos;)[-1]</span><br><span class="line">    return sum_page</span><br></pre></td></tr></table></figure>
<h1 id="7-用总页数来组合拼接出所有页面的url-并返回包含所有url的list"><a href="#7-用总页数来组合拼接出所有页面的url-并返回包含所有url的list" class="headerlink" title="7.用总页数来组合拼接出所有页面的url,并返回包含所有url的list"></a>7.用总页数来组合拼接出所有页面的url,并返回包含所有url的list</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">def get_all_page_urls(self, sumpage):</span><br><span class="line">    urls = []</span><br><span class="line">    baseurl = &apos;http://www.mmjpg.com/home/&apos;</span><br><span class="line">    ul = baseurl.split(&apos;/&apos;)</span><br><span class="line">    for page in range(1, int(sumpage) + 1):</span><br><span class="line">        ul[-1] = str(page)</span><br><span class="line">        url = &apos;/&apos;.join(ul)</span><br><span class="line">        urls.append(url)</span><br><span class="line">    return urls</span><br></pre></td></tr></table></figure>
<h1 id="8-获取每个图集的链接"><a href="#8-获取每个图集的链接" class="headerlink" title="8.获取每个图集的链接"></a>8.获取每个图集的链接</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&apos;&apos;&apos;由于首页图片点击进去之后还有图片，因此首页图片是一个图集链接，所以得先获取图集链接，进而获取里面的所有图片，分析网页代码得知，可对其连接进行提取，并同样返回一个list&apos;&apos;&apos;</span><br><span class="line">def get_page_links(self, urls):</span><br><span class="line">    page_links = []</span><br><span class="line">    for url in urls:</span><br><span class="line">        try:</span><br><span class="line">            selector = self.get_source_page(url)</span><br><span class="line">            lis = selector.xpath(&apos;//div[@class=&quot;pic&quot;]//li/a/@href&apos;)</span><br><span class="line">        except:</span><br><span class="line">            continue</span><br><span class="line">        for li in lis:</span><br><span class="line">            page_links.append(li)</span><br><span class="line">    return page_links</span><br></pre></td></tr></table></figure>
<h1 id="9-获取图片的src属性"><a href="#9-获取图片的src属性" class="headerlink" title="9.获取图片的src属性"></a>9.获取图片的src属性</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">def get_pic_link(self, url):</span><br><span class="line">    try:</span><br><span class="line">        selector = self.get_source_page(url)</span><br><span class="line">        src = selector.xpath(&apos;//div[@id=&quot;content&quot;]/a/img/@src&apos;)[0]</span><br><span class="line">    except:</span><br><span class="line">        src = None</span><br><span class="line">    finally:</span><br><span class="line">        return src</span><br></pre></td></tr></table></figure>
<h1 id="10-创建文件夹并用图集名进行命名"><a href="#10-创建文件夹并用图集名进行命名" class="headerlink" title="10.创建文件夹并用图集名进行命名"></a>10.创建文件夹并用图集名进行命名</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">def mk_pic_dir(self, dirname):</span><br><span class="line">    path = dirname</span><br><span class="line">    if not os.path.exists(path):</span><br><span class="line">        os.mkdir(path)</span><br><span class="line">    return path</span><br></pre></td></tr></table></figure>
<h1 id="11-进入所有图集，并下载所有图片"><a href="#11-进入所有图集，并下载所有图片" class="headerlink" title="11.进入所有图集，并下载所有图片"></a>11.进入所有图集，并下载所有图片</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">def download_all_pic(self, page_links):</span><br><span class="line">    for page_link in page_links:</span><br><span class="line">        try:</span><br><span class="line">            selector = self.get_source_page(page_link)</span><br><span class="line">            album_title = selector.xpath(&apos;//div[@class=&quot;article&quot;]/h2/text()&apos;)[0]</span><br><span class="line">            sum_pic = selector.xpath(&apos;//div[@id=&quot;page&quot;]/a[last()-1]/text()&apos;)[0]</span><br><span class="line">            path = self.mk_pic_dir(album_title)</span><br><span class="line">        except:</span><br><span class="line">            continue</span><br><span class="line">        for pic in range(1, int(sum_pic) + 1):</span><br><span class="line">            try:</span><br><span class="line">                print u&apos;正在下载--&gt;&apos; + album_title + u&apos;--&gt;第&apos; + str(pic) + u&apos;张美图...&apos;</span><br><span class="line">                pic_link = page_link + &apos;/&apos; + str(pic)</span><br><span class="line">                src = self.get_pic_link(pic_link)</span><br><span class="line">                filename = &apos;%s.jpg&apos; % (pic)</span><br><span class="line">            except:</span><br><span class="line">                continue</span><br><span class="line">            else:</span><br><span class="line">                try:</span><br><span class="line">                    &apos;&apos;&apos;增加打开图片链接时的头部referer属性&apos;&apos;&apos;</span><br><span class="line">                    req = urllib2.Request(src)</span><br><span class="line">                    req.add_header(&apos;Referer&apos;, &apos;http://img.mmjpg.com/&apos;)</span><br><span class="line">                    &apos;&apos;&apos;写入文件&apos;&apos;&apos;</span><br><span class="line">                    with open(path + &apos;/&apos; + filename, &apos;wb&apos;) as fp:</span><br><span class="line">                        fp.write(urllib2.urlopen(src, timeout=3).read())</span><br><span class="line">                 except:</span><br><span class="line">                    continue</span><br></pre></td></tr></table></figure>
<h1 id="12-大功告成，运行代码"><a href="#12-大功告成，运行代码" class="headerlink" title="12.大功告成，运行代码"></a>12.大功告成，运行代码</h1><p><img src="http://upload-images.jianshu.io/upload_images/8672685-13dd3315058324ad.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/666" alt="编辑器执行过程"><br><img src="http://upload-images.jianshu.io/upload_images/8672685-cbb30a717c39bed2.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/666" alt="以图集名命名的文件夹"><br><img src="http://upload-images.jianshu.io/upload_images/8672685-0bd8600346f8b6cc.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/666" alt="对应图集里面的所有图片"></p>
<blockquote>
<p>本实验的完整代码在<a href="https://github.com/zhouhaocheng/pyproject/blob/master/mmjpg/mmjpg.py" target="_blank" rel="noopener">Github</a>上，欢迎fork</p>
</blockquote>
]]></content>
      
        
        <tags>
            
            <tag> Python </tag>
            
            <tag> 爬虫 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[在Linux环境下mysql的root密码忘记解决方法]]></title>
      <url>/2017/12/24/%E5%9C%A8Linux%E7%8E%AF%E5%A2%83%E4%B8%8Bmysql%E7%9A%84root%E5%AF%86%E7%A0%81%E5%BF%98%E8%AE%B0%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/</url>
      <content type="html"><![CDATA[<blockquote>
<p>首先确认服务器出于安全的状态，也就是没有人能够任意地连接MySQL数据库</p>
<h1 id="1-修改MySQL的登录设置："><a href="#1-修改MySQL的登录设置：" class="headerlink" title="1.修改MySQL的登录设置："></a>1.修改MySQL的登录设置：</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># vi /etc/my.cnf</span><br><span class="line">在[mysqld]的段中加上一句：skip-grant-tables 保存并且退出</span><br></pre></td></tr></table></figure>
</blockquote>
<a id="more"></a>
<h1 id="2-重启mysql服务"><a href="#2-重启mysql服务" class="headerlink" title="2.重启mysql服务"></a>2.重启mysql服务</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service mysqld restart</span><br></pre></td></tr></table></figure>
<h1 id="3-登录并修改Mysql的root密码"><a href="#3-登录并修改Mysql的root密码" class="headerlink" title="3.登录并修改Mysql的root密码"></a>3.登录并修改Mysql的root密码</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">mysql&gt; USE mysql ;</span><br><span class="line">mysql&gt; UPDATE user SET Password = password ( &apos;new-password&apos; ) WHERE User = &apos;root&apos; ;</span><br><span class="line">mysql&gt; flush privileges ;</span><br><span class="line">mysql&gt; quit</span><br></pre></td></tr></table></figure>
<h1 id="4-恢复配置文件"><a href="#4-恢复配置文件" class="headerlink" title="4.恢复配置文件"></a>4.恢复配置文件</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># vi /etc/my.cnf</span><br><span class="line">将刚才在[mysqld]的段中加上的skip-grant-tables删除</span><br></pre></td></tr></table></figure>
<h1 id="5-重启mysql服务"><a href="#5-重启mysql服务" class="headerlink" title="5.重启mysql服务"></a>5.重启mysql服务</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># /etc/init.d/mysqld restart   ( service mysqld restart )</span><br></pre></td></tr></table></figure>
]]></content>
      
        
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[手把手教你安装Zabbix3.0]]></title>
      <url>/2017/12/24/zabbix/</url>
      <content type="html"><![CDATA[<blockquote>
<p>Zabbix是一个企业级的开源分布式监控解决方案，能监视各种网络参数，保证服务器系统的安全运营。但由于网上Zabbix的搭建教程多而杂，因此我整理了一篇详细搭建Zabbix的完整教程，适合新手入门学习Zabbix。</p>
<h3 id="本实验软件版本"><a href="#本实验软件版本" class="headerlink" title="本实验软件版本:"></a>本实验软件版本:</h3><ul>
<li>Cenos6.8，Nginx:1.9.15 , MySQL:5.5.49 , PHP:5.5.35，zabbix3.0.12<a id="more"></a>
<h1 id="注意"><a href="#注意" class="headerlink" title="注意"></a>注意</h1></li>
<li>搭建Zabbix前提需要有LAMP/LNMP环境，本文也将列出其详细安装步骤</li>
<li>开始搭建之前，将Nginx:1.9.15 , MySQL:5.5.49 , PHP:5.5.35，zabbix3.0.12几个软件包下载下来，并放到系统中</li>
</ul>
</blockquote>
<h1 id="一-安装Nginx"><a href="#一-安装Nginx" class="headerlink" title="一.安装Nginx"></a>一.安装Nginx</h1><h3 id="1-1-安装依赖包"><a href="#1-1-安装依赖包" class="headerlink" title="1.1 安装依赖包"></a>1.1 安装依赖包</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@haocheng ~]# yum -y install gcc gcc-c++ autoconf automake zlib zlib-devel openssl openssl-devel pcre* make gd-devel libjpeg-devel libpng-devel libxml2-devel bzip2-devel libcurl-devel</span><br></pre></td></tr></table></figure>
<h3 id="1-2-创建用户"><a href="#1-2-创建用户" class="headerlink" title="1.2 创建用户"></a>1.2 创建用户</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@haocheng ~]# useradd nginx -s /sbin/nologin -M</span><br></pre></td></tr></table></figure>
<h3 id="1-3-将下载好的Nginx解压并进入到目录中"><a href="#1-3-将下载好的Nginx解压并进入到目录中" class="headerlink" title="1.3 将下载好的Nginx解压并进入到目录中"></a>1.3 将下载好的Nginx解压并进入到目录中</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@haocheng ~]# tar xvf nginx-1.9.15.tar.gz &amp;&amp; cd nginx-1.9.15</span><br></pre></td></tr></table></figure>
<h3 id="1-4-配置并进行编译"><a href="#1-4-配置并进行编译" class="headerlink" title="1.4 配置并进行编译"></a>1.4 配置并进行编译</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@haocheng nginx-1.9.15]# ./configure --prefix=/usr/local/product/nginx1.9.14 --user=www --group=www --with-http_ssl_module --with-http_v2_module --with-http_stub_status_module --with-pcre</span><br><span class="line">[root@haocheng nginx-1.9.15]# make &amp;&amp; make install</span><br><span class="line">[root@haocheng nginx-1.9.15]# ln -s /usr/local/product/nginx1.9.14 /usr/local/nginx</span><br></pre></td></tr></table></figure>
<h3 id="1-5-部分参数解释："><a href="#1-5-部分参数解释：" class="headerlink" title="1.5 部分参数解释："></a>1.5 部分参数解释：</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">--with-http_stub_status_module：支持nginx状态查询</span><br><span class="line">--with-http_ssl_module：支持https</span><br><span class="line">--with-http_spdy_module：支持google的spdy,这个必须ssl支持</span><br><span class="line">--with-pcre：为了支持rewrite重写功能，必须制定pcre</span><br></pre></td></tr></table></figure>
<h1 id="二-安装PHP"><a href="#二-安装PHP" class="headerlink" title="二.安装PHP"></a>二.安装PHP</h1><h3 id="2-1-解压并编译，配置"><a href="#2-1-解压并编译，配置" class="headerlink" title="2.1 解压并编译，配置"></a>2.1 解压并编译，配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@haocheng ~]# tar xvf php-5.5.35.tar.gz &amp;&amp; cd php-5.5.35</span><br><span class="line">[root@haocheng php-5.5.35]# ./configure --prefix=/usr/local/product/php-5.5.35 --with-config-file-path=/usr/local/product/php-5.5.35/etc --with-bz2 --with-curl --enable-ftp --enable-sockets --disable-ipv6 --with-gd --with-jpeg-dir=/usr/local --with-png-dir=/usr/local --with-freetype-dir=/usr/local --enable-gd-native-ttf --with-iconv-dir=/usr/local --enable-mbstring --enable-calendar --with-gettext --with-libxml-dir=/usr/local --with-zlib --with-pdo-mysql=mysqlnd --with-mysqli=mysqlnd --with-mysql=mysqlnd --enable-dom --enable-xml --enable-fpm --with-libdir=lib64 --enable-bcmath</span><br><span class="line">[root@haocheng php-5.5.35]# make &amp;&amp; make install</span><br><span class="line">[root@haocheng php-5.5.35]# ln -s /usr/local/product/php-5.5.35 /usr/local/php</span><br><span class="line">[root@haocheng php-5.5.35]# cp php.ini-production /usr/local/php/etc/php.ini</span><br><span class="line">[root@haocheng php-5.5.35]# cd /usr/local/php/etc/</span><br><span class="line">[root@haocheng etc]# cp php-fpm.conf.default php-fpm.conf</span><br></pre></td></tr></table></figure>
<h3 id="2-2-修改php-ini参数（zabbix环境需要修改的参数）"><a href="#2-2-修改php-ini参数（zabbix环境需要修改的参数）" class="headerlink" title="2.2  修改php.ini参数（zabbix环境需要修改的参数）"></a>2.2  修改php.ini参数（zabbix环境需要修改的参数）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">max_execution_time = 300 </span><br><span class="line">memory_limit = 128M </span><br><span class="line">post_max_size = 16M </span><br><span class="line">upload_max_filesize = 2M </span><br><span class="line">max_input_time = 300 </span><br><span class="line">date.timezone = PRC</span><br></pre></td></tr></table></figure>
<h1 id="三-安装MySQL"><a href="#三-安装MySQL" class="headerlink" title="三.安装MySQL"></a>三.安装MySQL</h1><h3 id="3-1-添加mysql用户，创建mysql的数据目录"><a href="#3-1-添加mysql用户，创建mysql的数据目录" class="headerlink" title="3.1 添加mysql用户，创建mysql的数据目录"></a>3.1 添加mysql用户，创建mysql的数据目录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@haocheng ~]# groupadd mysql</span><br><span class="line">[root@haocheng ~]# mkdir -pv /data/mysql</span><br><span class="line">[root@haocheng ~]# useradd -r -g mysql -d /data/mysql -s /sbin/nologin mysql</span><br><span class="line">[root@haocheng ~]# chown -R mysql.mysql /data/mysql</span><br></pre></td></tr></table></figure>
<h3 id="3-2-安装cmake及依赖"><a href="#3-2-安装cmake及依赖" class="headerlink" title="3.2 安装cmake及依赖"></a>3.2 安装cmake及依赖</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@haocheng ~]# yum install cmake gcc* ncurses-devel -y</span><br></pre></td></tr></table></figure>
<h3 id="3-3-编译安装MySQL"><a href="#3-3-编译安装MySQL" class="headerlink" title="3.3 编译安装MySQL"></a>3.3 编译安装MySQL</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@haocheng ~]# tar -xvf mysql-5.5.49.tar.gz &amp;&amp; cd mysql-5.5.49</span><br><span class="line">[root@haocheng mysql-5.5.49]# cmake -DCMAKE_INSTALL_PREFIX=/usr/local/product/mysql5.5.49 -DDEFAULT_CHARSET=utf8 -DENABLED_LOCAL_INFILE=1 -DMYSQL_DATADIR=/data/mysql -DWITH_EXTRA_CHARSETS=all -DWITH_READLINE=1 -DWITH_INNOBASE_STORAGE_ENGINE=1 -DMYSQL_TCP_PORT=3306 -DDEFAULT_COLLATION=utf8_general_ci</span><br><span class="line">[root@haocheng mysql-5.5.49]# make &amp;&amp; make install</span><br><span class="line">[root@haocheng mysql-5.5.49]# ln -s /usr/local/product/mysql5.5.49 /usr/local/mysql</span><br><span class="line">[root@haocheng mysql-5.5.49]# chown -R mysql.mysql /usr/local/mysql</span><br></pre></td></tr></table></figure>
<h3 id="3-4-拷贝mysql的配置文件"><a href="#3-4-拷贝mysql的配置文件" class="headerlink" title="3.4 拷贝mysql的配置文件"></a>3.4 拷贝mysql的配置文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@haocheng mysql-5.5.49]# cd /usr/local/mysql/support-files/</span><br><span class="line">[root@haocheng support-files]# cp my-medium.cnf /data/mysql/my.cnf</span><br><span class="line">[root@haocheng support-files]# cp mysql.server /etc/init.d/mysqld</span><br><span class="line">[root@haocheng support-files]# chmod +x /etc/init.d/mysqld</span><br></pre></td></tr></table></figure>
<h3 id="3-5-初始化MySQL"><a href="#3-5-初始化MySQL" class="headerlink" title="3.5 初始化MySQL"></a>3.5 初始化MySQL</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@haocheng support-files]# cd /usr/local/mysql/scripts</span><br><span class="line">[root@haocheng scripts]# ./mysql_install_db --user=mysql --basedir=/usr/local/mysql/ --datadir=/data/mysql/</span><br></pre></td></tr></table></figure>
<h3 id="3-6-修改MySQL配置文件my-cnf中数据目录"><a href="#3-6-修改MySQL配置文件my-cnf中数据目录" class="headerlink" title="3.6 修改MySQL配置文件my.cnf中数据目录"></a>3.6 修改MySQL配置文件my.cnf中数据目录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">datadir=/data/mysql/</span><br></pre></td></tr></table></figure>
<h3 id="3-7-启动MySQL"><a href="#3-7-启动MySQL" class="headerlink" title="3.7 启动MySQL"></a>3.7 启动MySQL</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@haocheng ~]# /etc/init.d/mysqld start</span><br><span class="line">Starting MySQL..                                           [  OK  ]</span><br></pre></td></tr></table></figure>
<h3 id="3-8-创建软链接"><a href="#3-8-创建软链接" class="headerlink" title="3.8 创建软链接"></a>3.8 创建软链接</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@haocheng ~]# ln -s /usr/local/mysql/bin/mysql /usr/bin</span><br><span class="line">[root@haocheng ~]# ln -s /usr/local/mysql/bin/mysqladmin /usr/bin</span><br></pre></td></tr></table></figure>
<h3 id="3-9-登录数据库，创建zabbix数据库及用户名和密码"><a href="#3-9-登录数据库，创建zabbix数据库及用户名和密码" class="headerlink" title="3.9 登录数据库，创建zabbix数据库及用户名和密码"></a>3.9 登录数据库，创建zabbix数据库及用户名和密码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@haocheng ~]# mysql</span><br><span class="line">mysql&gt; create database zabbix default charset utf8;</span><br><span class="line">Query OK, 1 row affected (0.00 sec)</span><br><span class="line">mysql&gt; grant all privileges on zabbix.* to zabbix@&apos;localhost&apos; identified by &apos;zabbix&apos;;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br><span class="line">mysql&gt; flush privileges;</span><br><span class="line">Query OK, 0 rows affected (0.00 sec)</span><br></pre></td></tr></table></figure>
<h3 id="3-10-为数据库的root创建密码"><a href="#3-10-为数据库的root创建密码" class="headerlink" title="3.10 为数据库的root创建密码"></a>3.10 为数据库的root创建密码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@haocheng ~]# mysqladmin -uroot password  &quot;zabbix&quot;</span><br></pre></td></tr></table></figure>
<h1 id="四-安装zabbix-server"><a href="#四-安装zabbix-server" class="headerlink" title="四.安装zabbix server"></a>四.安装zabbix server</h1><h3 id="4-1-安装依赖软件"><a href="#4-1-安装依赖软件" class="headerlink" title="4.1 安装依赖软件"></a>4.1 安装依赖软件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@haocheng ~]# yum install mysql-devel net-snmp-devel -y</span><br></pre></td></tr></table></figure>
<h3 id="4-2-安装zabbix"><a href="#4-2-安装zabbix" class="headerlink" title="4.2 安装zabbix"></a>4.2 安装zabbix</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@haocheng ~]# tar zxf zabbix-3.0.12.tar.gz &amp;&amp; cd zabbix-3.0.12</span><br></pre></td></tr></table></figure>
<h3 id="4-3-编译zabbix"><a href="#4-3-编译zabbix" class="headerlink" title="4.3 编译zabbix"></a>4.3 编译zabbix</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@haocheng zabbix-3.0.12]# ./configure --prefix=/usr/local/zabbix-3.0.12/ --enable-server --enable-agent --with-mysql --with-net-snmp --with-libcurl --with-libxml2 </span><br><span class="line">[root@haocheng zabbix-3.0.12]# make &amp;&amp; make install</span><br></pre></td></tr></table></figure>
<h3 id="4-4-创建zabbix组-用户"><a href="#4-4-创建zabbix组-用户" class="headerlink" title="4.4 创建zabbix组,用户"></a>4.4 创建zabbix组,用户</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@haocheng zabbix-3.0.12]# groupadd zabbix</span><br><span class="line">[root@haocheng zabbix-3.0.12]# useradd zabbix -s /sbin/nologin -M -g zabbix</span><br></pre></td></tr></table></figure>
<h3 id="4-5-创建软链接"><a href="#4-5-创建软链接" class="headerlink" title="4.5 创建软链接"></a>4.5 创建软链接</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@haocheng zabbix-3.0.12]# mkdir /var/lib/mysql</span><br><span class="line">[root@haocheng zabbix-3.0.12]# ln -s /tmp/mysql.sock /var/lib/mysql/</span><br></pre></td></tr></table></figure>
<h3 id="4-6-zabbix-server需要导入3个sql文件"><a href="#4-6-zabbix-server需要导入3个sql文件" class="headerlink" title="4.6 zabbix server需要导入3个sql文件"></a>4.6 zabbix server需要导入3个sql文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@haocheng zabbix-3.0.12]# mysql -uroot -pzabbix zabbix &lt; database/mysql/schema.sql</span><br><span class="line">[root@haocheng zabbix-3.0.12]# mysql -uroot -pzabbix zabbix &lt; database/mysql/images.sql</span><br><span class="line">[root@haocheng zabbix-3.0.12]# mysql -uroot -pzabbix zabbix &lt; database/mysql/data.sql</span><br></pre></td></tr></table></figure>
<h1 id="五-zabbix管理网站配置-Nginx"><a href="#五-zabbix管理网站配置-Nginx" class="headerlink" title="五.zabbix管理网站配置(Nginx)"></a>五.zabbix管理网站配置(Nginx)</h1><h3 id="5-1-创建项目目录"><a href="#5-1-创建项目目录" class="headerlink" title="5.1 创建项目目录"></a>5.1 创建项目目录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@haocheng zabbix-3.0.12]# mkdir /data/web/zabbix.haocheng.com -p     </span><br><span class="line">[root@haocheng zabbix-3.0.12]# mkdir /data/logs/zabbix -p</span><br></pre></td></tr></table></figure>
<h3 id="5-2-将前端文件拷贝到项目目录下"><a href="#5-2-将前端文件拷贝到项目目录下" class="headerlink" title="5.2 将前端文件拷贝到项目目录下"></a>5.2 将前端文件拷贝到项目目录下</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@haocheng zabbix-3.0.12]# cp -rp frontends/php/* /data/web/zabbix.haocheng.com/</span><br></pre></td></tr></table></figure>
<h3 id="5-3-编辑nginx虚拟主机"><a href="#5-3-编辑nginx虚拟主机" class="headerlink" title="5.3 编辑nginx虚拟主机"></a>5.3 编辑nginx虚拟主机</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[root@haocheng zabbix-3.0.12]# cd /usr/local/nginx/conf</span><br><span class="line">[root@haocheng conf]# mkdir extra</span><br><span class="line">[root@haocheng conf]# cd extra/</span><br><span class="line">[root@haocheng extra]# vim zabbix.conf</span><br><span class="line">server &#123;</span><br><span class="line">listen 8027;</span><br><span class="line">server_name zabbix.haocheng.com;</span><br><span class="line">access_log /data/logs/zabbix/zabbix.haocheng.com.access.log main;</span><br><span class="line">index index.html index.php index.html;</span><br><span class="line">root /data/web/zabbix.haocheng.com;</span><br><span class="line"></span><br><span class="line">location /&#123;</span><br><span class="line">       try_files $uri $uri/ /index.php?$args;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">location ~ ^(.+.php)(.*)$ &#123;</span><br><span class="line">       fastcgi_split_path_info ^(.+.php)(.*)$;</span><br><span class="line">       include fastcgi.conf;</span><br><span class="line">       fastcgi_pass 127.0.0.1:9000;</span><br><span class="line">       fastcgi_index index.php;</span><br><span class="line">       fastcgi_param PATH_INFO $fastcgi_path_info;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-4-编辑nginx-conf配置文件"><a href="#5-4-编辑nginx-conf配置文件" class="headerlink" title="5.4 编辑nginx.conf配置文件"></a>5.4 编辑nginx.conf配置文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[root@haocheng conf]# vim nginx.conf</span><br><span class="line">user  nginx;</span><br><span class="line">worker_processes  1;</span><br><span class="line"></span><br><span class="line">#error_log  logs/error.log warning;</span><br><span class="line">#error_log  logs/error.log  notice;</span><br><span class="line">#error_log  logs/error.log  info;</span><br><span class="line"></span><br><span class="line">pid        logs/nginx.pid;</span><br><span class="line"></span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections  1024;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">http &#123;</span><br><span class="line">    include       mime.types;</span><br><span class="line">    default_type  application/octet-stream;</span><br><span class="line"></span><br><span class="line">    log_format  main  &apos;$remote_addr - $remote_user [$time_local] &quot;$request&quot; &apos;</span><br><span class="line">                      &apos;$status $body_bytes_sent &quot;$http_referer&quot; &apos;</span><br><span class="line">                      &apos;&quot;$http_user_agent&quot; &quot;$http_x_forwarded_for&quot;&apos;;</span><br><span class="line"></span><br><span class="line">    access_log  logs/access.log  main;</span><br><span class="line"></span><br><span class="line">    sendfile        on;</span><br><span class="line">    #tcp_nopush     on;</span><br><span class="line"></span><br><span class="line">    #keepalive_timeout  0;</span><br><span class="line">    keepalive_timeout  65;</span><br><span class="line"></span><br><span class="line">    #gzip  on;</span><br><span class="line">    include extra/*.conf;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="5-5-修改zabbix-server-conf文件"><a href="#5-5-修改zabbix-server-conf文件" class="headerlink" title="5.5 修改zabbix_server.conf文件"></a>5.5 修改zabbix_server.conf文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@haocheng conf]# cd /usr/local/zabbix-3.0.12/etc</span><br><span class="line">[root@haocheng etc]# vim zabbix_server.conf</span><br><span class="line">LogFile=/tmp/zabbix_server.log</span><br><span class="line">PidFile=/tmp/zabbix_server.pid</span><br><span class="line">DBHost=localhost</span><br><span class="line">DBName=zabbix</span><br><span class="line">DBUser=zabbix</span><br><span class="line">DBPassword=zabbix</span><br></pre></td></tr></table></figure>
<h1 id="六-启动服务"><a href="#六-启动服务" class="headerlink" title="六.启动服务"></a>六.启动服务</h1><h3 id="6-1-启动nginx"><a href="#6-1-启动nginx" class="headerlink" title="6.1 启动nginx"></a>6.1 启动nginx</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@haocheng ~]# /usr/local/nginx/sbin/nginx</span><br></pre></td></tr></table></figure>
<h3 id="6-2-启动PHP"><a href="#6-2-启动PHP" class="headerlink" title="6.2 启动PHP"></a>6.2 启动PHP</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@haocheng ~]# /usr/local/php/sbin/php-fpm</span><br></pre></td></tr></table></figure>
<h3 id="6-3-启动zabbix-server"><a href="#6-3-启动zabbix-server" class="headerlink" title="6.3 启动zabbix server"></a>6.3 启动zabbix server</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@haocheng ~]# /usr/local/zabbix-3.0.12/sbin/zabbix_server</span><br><span class="line">[root@haocheng ~]# ln -s /usr/local/mysql/lib/libmysqlclient.so.18 /usr/lib64/</span><br></pre></td></tr></table></figure>
<h3 id="6-4-添加-etc-hosts文件-对应自己机器IP"><a href="#6-4-添加-etc-hosts文件-对应自己机器IP" class="headerlink" title="6.4 添加/etc/hosts文件(对应自己机器IP)"></a>6.4 添加/etc/hosts文件(对应自己机器IP)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10.0.2.15   zabbix.haocheng.com</span><br></pre></td></tr></table></figure>
<h3 id="6-5-查看服务端口"><a href="#6-5-查看服务端口" class="headerlink" title="6.5 查看服务端口"></a>6.5 查看服务端口</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@haocheng ~]# netstat -lntup(查看是否有8027)</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/8672685-dfe5136af73076ab.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/666" alt="查看端口"></p>
<h3 id="6-6-将服务加入开机自启动"><a href="#6-6-将服务加入开机自启动" class="headerlink" title="6.6 将服务加入开机自启动"></a>6.6 将服务加入开机自启动</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@haocheng ~]# echo &quot;/usr/local/nginx/sbin/nginx&quot; &gt;&gt;/etc/rc.local </span><br><span class="line">[root@haocheng ~]# echo &quot;/usr/local/php/sbin/php-fpm&quot; &gt;&gt;/etc/rc.local </span><br><span class="line">[root@haocheng ~]# echo &quot;/etc/init.d/mysqld start&quot; &gt;&gt;/etc/rc.local</span><br><span class="line">[root@haocheng ~]# echo &quot;/usr/local/zabbix-3.0.3/sbin/zabbix_server&quot; &gt;&gt;/etc/rc.local</span><br></pre></td></tr></table></figure>
<h1 id="七-web端配置zabbix"><a href="#七-web端配置zabbix" class="headerlink" title="七. web端配置zabbix"></a>七. web端配置zabbix</h1><p><img src="http://upload-images.jianshu.io/upload_images/8672685-8008a4520f12e19f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/666" alt="按下一步进行配置"><br><img src="http://upload-images.jianshu.io/upload_images/8672685-6d2248b1dbf8835f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/666" alt="确保全部是OK再进行下一步"><br><img src="http://upload-images.jianshu.io/upload_images/8672685-6c16d1f99cb2b984.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/666" alt="设置数据库"><br><img src="http://upload-images.jianshu.io/upload_images/8672685-7b40a1da5e47fccb.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/666" alt="参数默认即可"><br><img src="http://upload-images.jianshu.io/upload_images/8672685-9150b5306f27ec69.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/666" alt="检查配置信息"><br><img src="http://upload-images.jianshu.io/upload_images/8672685-9ed610e3e0d88e0f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/666" alt="下载文件"><br><img src="http://upload-images.jianshu.io/upload_images/8672685-17a6a277c24c2aab.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/666" alt="修改文件属主权限 "></p>
<p><img src="http://upload-images.jianshu.io/upload_images/8672685-1ce4d5421ee4d204.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/666" alt="安装完成"><br><img src="http://upload-images.jianshu.io/upload_images/8672685-214d47a03ca5f42e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/666" alt="默认管理员账号为Admin,密码为zabbix"><br><img src="http://upload-images.jianshu.io/upload_images/8672685-c7dd482537348672.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/666" alt="成功登入"></p>
<ul>
<li>如果想要将界面换成中文，则可以按以下步骤操作<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@haocheng conf]# vim /data/web/zabbix.haocheng.com/include/locales.inc.php</span><br><span class="line">找到zh_CN  将，flase改为true</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p><img src="http://upload-images.jianshu.io/upload_images/8672685-b22b35b1a3243e49.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/666" alt="点击红色方框"><br><img src="http://upload-images.jianshu.io/upload_images/8672685-669e5246b8abcc90.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/666" alt="选择中文字体,确定"><br><img src="http://upload-images.jianshu.io/upload_images/8672685-b3c9295b928be75d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/666" alt="最终效果"></p>
<h1 id="至此，zabbix服务端已经安装完毕。"><a href="#至此，zabbix服务端已经安装完毕。" class="headerlink" title="至此，zabbix服务端已经安装完毕。"></a>至此，zabbix服务端已经安装完毕。</h1>]]></content>
      
        
        <tags>
            
            <tag> zabbix </tag>
            
            <tag> nnn </tag>
            
        </tags>
        
    </entry>
    
  
  
</search>
